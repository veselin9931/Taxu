(self.webpackChunkcsharpcornerauthor=self.webpackChunkcsharpcornerauthor||[]).push([[4476],{297:function(e,r,t){"use strict";t.d(r,{p:function(){return c}});var i=t(205),s=t(5304),n=t(3342),o=t(2340),a=t(3018),d=t(1841),h=t(728);let c=(()=>{class e{constructor(e,r){this.http=e,this.sharedService=r,this.orders=[],this.completedOrder=!1}createOrder(e){const r=this.sharedService.headerGerneration();return this.http.post(`${o.N.apiUrl}/api/order`,e,{headers:r,responseType:"text"}).pipe((0,s.K)(this.handleError))}addToFavourites(e){const r=this.sharedService.headerGerneration();return this.http.post(`${o.N.apiUrl}/api/order/favourites`,e,{headers:r,responseType:"text"}).pipe((0,s.K)(this.handleError))}getMyFavourites(e){const r=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/favourites/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}deleteFavouriteOrder(e){const r=this.sharedService.headerGerneration();return this.http.delete(`${o.N.apiUrl}/api/order/favourites/${e}`,{headers:r}).pipe((0,n.b)(e=>console.log("deleted favourite order: ",JSON.stringify(e))),(0,s.K)(this.handleError))}getDirections(e,r,t,i){const n=this.sharedService.headerGerneration();return this.http.post(`https://maps.googleapis.com/maps/api/distancematrix/json?units=imperial&origins=${e},${r}&destinations=${t}%2C${i}%7C&key=AIzaSyAEvlXdM4joG4bNVT5l-tJSk9lUSGhxMNw`,{headers:n,responseType:"text"}).pipe((0,s.K)(this.handleError))}getOrderById(e){const r=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/id/${e}`,{headers:r}).pipe((0,n.b)(e=>this.order=e))}getCanceledOrderById(e){const r=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/canceled/${e}`,{headers:r}).pipe((0,n.b)(e=>this.order=e))}getLastCompletedOrder(e){const r=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/completed/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}getMyOrder(e){const r=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}getOrderForChat(e){const r=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/chat/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}getAllOrders(){const e=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order`,{headers:e}).pipe((0,s.K)(this.handleError))}getNormalOrders(){const e=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/normal`,{headers:e}).pipe((0,s.K)(this.handleError))}getComfortOrders(){const e=this.sharedService.headerGerneration();return this.http.get(`${o.N.apiUrl}/api/order/comfort`,{headers:e}).pipe((0,s.K)(this.handleError))}acceptOrder(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,n.b)(e=>this.driverId=r),(0,s.K)(this.handleError))}updateOrderEta(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/eta/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,s.K)(this.handleError))}updateDriverArrived(e){const r=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/arrived/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}rateOrder(e){const r=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/rate/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}increaseOrderPrice(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/increase/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,s.K)(this.handleError))}completeOrder(e){const r=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}deleteOrder(e){const r=this.sharedService.headerGerneration();return this.http.delete(`${o.N.apiUrl}/api/order/${e}`,{headers:r}).pipe((0,n.b)(e=>console.log("deleted order: ",JSON.stringify(e))),(0,s.K)(this.handleError))}driverIncreaseOrderPrice(e,r,t){const i=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/increased/${e}/${r}/${t}`,{headers:i,responseType:"json"}).pipe((0,s.K)(this.handleError))}resetIncreasing(e){const r=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/reset/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}increasedOrderAccept(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/accepted/increase/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,s.K)(this.handleError))}incrementOrderPrice(e){const r=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/increment/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}decrementOrderPrice(e){const r=this.sharedService.headerGerneration();return this.http.put(`${o.N.apiUrl}/api/order/decrement/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}handleError(e){let r="";return e.error instanceof ErrorEvent?(console.log("Client side error."),r=`Error: ${e.error.message}`):(console.log("Server side error."),r=`Error Code: ${e.status}\nMessage: ${e.message}`),console.log(r),(0,i._)(r)}}return e.\u0275fac=function(r){return new(r||e)(a.LFG(d.eN),a.LFG(h.F))},e.\u0275prov=a.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},4476:function(e,r,t){"use strict";t.r(r),t.d(r,{DrivingPageModule:function(){return N},HttpLoaderFactory:function(){return w}});var i=t(8583),s=t(3679),n=t(7823),o=t(4481),a=t(4762),d=t(4426),h=t(2340),c=t(8442),l=t(6522),p=t(3018),u=t(297),g=t(5056),v=t(1799),m=t(7800),f=t(3897),O=t(4441);const Z=function(e){return["/menu/order-details",e]};function y(e,r){if(1&e&&(p.TgZ(0,"div",16),p.TgZ(1,"a",9),p.TgZ(2,"div",11),p._UZ(3,"h5",17),p.TgZ(4,"small"),p._uU(5),p.ALo(6,"date"),p.qZA(),p.qZA(),p.TgZ(7,"p"),p._UZ(8,"ion-icon",18),p._uU(9),p.qZA(),p._UZ(10,"hr"),p.TgZ(11,"p"),p._UZ(12,"ion-icon",19),p._uU(13),p.qZA(),p.TgZ(14,"div",11),p._UZ(15,"h5",17),p.TgZ(16,"button",20),p._uU(17),p.ALo(18,"translate"),p.qZA(),p.qZA(),p.qZA(),p.qZA()),2&e){const e=r.$implicit;p.xp6(5),p.Oqu(p.xi3(6,5,e.createdOn,"dd/MM/yyyy HH:mm")),p.xp6(4),p.Oqu(e.location),p.xp6(4),p.Oqu(e.destination),p.xp6(3),p.Q6J("routerLink",p.VKq(10,Z,e.id)),p.xp6(1),p.Oqu(p.lcZ(18,8,"Order details"))}}function b(e,r){if(1&e&&(p.TgZ(0,"div",14),p.YNc(1,y,19,12,"div",15),p.qZA()),2&e){const e=p.oxw();p.xp6(1),p.Q6J("ngForOf",e.orders)}}function T(e,r){if(1&e){const e=p.EpF();p.TgZ(0,"div",16),p.TgZ(1,"a",9),p.TgZ(2,"div",11),p.TgZ(3,"small"),p._uU(4),p.ALo(5,"date"),p.qZA(),p.TgZ(6,"small"),p._UZ(7,"i",21),p._uU(8),p.qZA(),p.qZA(),p.TgZ(9,"h4",22),p._uU(10),p._UZ(11,"ion-icon",19),p._uU(12),p.qZA(),p._UZ(13,"hr"),p.TgZ(14,"div",23),p.TgZ(15,"p"),p._uU(16),p.qZA(),p._UZ(17,"br"),p.qZA(),p.TgZ(18,"div",23),p.TgZ(19,"p"),p._UZ(20,"ion-icon",24),p._uU(21),p.qZA(),p.qZA(),p.TgZ(22,"div",11),p.TgZ(23,"button",25),p.NdJ("click",function(){p.CHM(e);const t=r.$implicit;return p.oxw(2).acceptSubOrder(t)}),p._uU(24),p.ALo(25,"translate"),p.qZA(),p.qZA(),p.qZA(),p.qZA()}if(2&e){const e=r.$implicit;p.xp6(4),p.Oqu(p.xi3(5,8,e.createdOn,"dd/MM/yyyy HH:mm")),p.xp6(4),p.hij(" ",e.date,""),p.xp6(2),p.hij("",e.location," "),p.xp6(2),p.hij(" ",e.destination,""),p.xp6(4),p.Oqu(e.info),p.xp6(5),p.AsE(" ",e.applicationUser.firstName," ",e.applicationUser.lastName," "),p.xp6(3),p.Oqu(p.lcZ(25,11,"Accept"))}}function S(e,r){if(1&e&&(p.TgZ(0,"div",14),p.YNc(1,T,26,13,"div",15),p.qZA()),2&e){const e=p.oxw();p.xp6(1),p.Q6J("ngForOf",e.subOrders)}}function $(e,r){1&e&&p._UZ(0,"div",4)}const{Geolocation:A}=c.Vn,x=[{path:"",component:(()=>{class e{constructor(e,r,t,i,s,n,o,a){this.route=e,this.orderService=r,this.accountService=t,this.driverService=i,this.translate=s,this.popoverController=n,this.subOrderService=o,this.optionService=a,this.orders=[],this.subOrders=[],this.closeOrders=[],this.subscriptions=[],this.translate.setDefaultLang(this.accountService.userValue.choosenLanguage),this.getMyLocation()}ngOnInit(){this.isSubOreder=!1;const e=(new d.su).configureLogging(d.in.Information).withUrl(`${h.N.signalRUrl}/orderHub`,d.n4.WebSockets|d.n4.LongPolling).build();e.start().then(function(){console.log("signalR Connected in driving")}).catch(function(r){console.log("Reconnecting in 1 sec."),setTimeout(()=>e.start(),1e3)}),e.on("BroadcastMessage",()=>{console.log("broadcasted from driving")}),e.on("CreatedOrder",()=>{this.getData()}),e.on("OrderDeleted",()=>{this.getData()})}ionViewDidEnter(){this.getMyLocation(),this.categoryType=this.driverService.categoryType,this.getData()}getMyLocation(){return(0,a.mG)(this,void 0,void 0,function*(){const e=yield A.getCurrentPosition(),r={lat:e.coords.latitude,lng:e.coords.longitude};this.myLat=r.lat.toString(),this.myLng=r.lng.toString()})}getData(){!0===this.accountService.userValue.isDrivingNow&&this.route.navigate(["menu/driving-mode"]),this.driverService.getDriver(this.accountService.userValue.driverId).subscribe(e=>{"Normal"==this.driverService.categoryType?(this.isSubOreder=!1,this.getNormalOrders(e.rating)):"Comfort"==this.driverService.categoryType?(this.isSubOreder=!1,this.getComfortOrders(e.rating)):"Out of town"==this.driverService.categoryType?this.getOutOfTown():"Closest"==this.driverService.categoryType?(this.isSubOreder=!1,this.getClosestOrders(e.rating)):("All"==this.driverService.categoryType||null==this.driverService.categoryType)&&(this.isSubOreder=!1,this.getAllOrders(e.rating))})}getOutOfTown(){this.subscriptions.push(this.subOrderService.getAllSubOrders("Waiting").subscribe(e=>{null!=e&&(this.isSubOreder=!0,this.subOrders=e,this.subOrders.forEach(e=>{this.optionService.getOptionById(e.optionsId).subscribe(r=>{let t=r;e.location=t.location,e.destination=t.destination})}),console.log(this.subOrders))}))}acceptSubOrder(e){this.subscriptions.push(this.subOrderService.editStatus(e.id,{acceptedBy:this.accountService.userValue.id,status:"Accepted"}).subscribe(e=>{e&&this.route.navigate(["menu/reservations"])}))}getAllOrders(e){this.subscriptions.push(this.orderService.getAllOrders().subscribe(r=>{if(null==r)return;if(r.length<this.orders.length)return void(this.orders=r);r.sort((e,r)=>new Date(r.createdOn)-new Date(e.createdOn));let t=0;e>=0&&e<=2&&(t=9,this.message=`Your rating is ${e} / 10. If there are any orders they will appear after approx 9 seconds.`,setTimeout(()=>{this.orders=r},9e3)),e>=2&&e<=4&&(t=7,this.message=`Your rating is ${e} / 10. If there are any orders they will appear after approx 7 seconds.`,setTimeout(()=>{this.orders=r},7e3)),e>=4&&e<=6&&(t=5,this.message=`Your rating is ${e} / 10. If there are any orders they will appear after approx 5 seconds.`,setTimeout(()=>{this.orders=r},5e3)),e>=6&&e<=8&&(t=3,this.message=`Your rating is ${e} / 10. If there are any orders they will appear after approx 3 seconds.`,setTimeout(()=>{this.orders=r},3e3));let i={};i.first=this.translate.instant("Your rating is "),i.second=this.translate.instant("If there are any orders they will appear after approx"),i.third=this.translate.instant("seconds"),this.message=`${i.first} ${e}/10 ${i.second} ${t} ${i.third}`,e>=8&&e<=10&&(t=1,this.message="",setTimeout(()=>{this.orders=r},1e3)),this.calculateClosest()}))}getNormalOrders(e){this.subscriptions.push(this.orderService.getNormalOrders().subscribe(r=>{null!=r&&(r.length<this.orders.length?this.orders=r:(e>=0&&e<=2&&setTimeout(()=>{this.orders=r},1e4),e>=2&&e<=4&&setTimeout(()=>{this.orders=r},8e3),e>=4&&e<=6&&setTimeout(()=>{this.orders=r},5e3),e>=6&&e<=8&&setTimeout(()=>{this.orders=r},3e3),e>=8&&e<=10&&setTimeout(()=>{this.orders=r},1e3)))}))}getComfortOrders(e){this.subscriptions.push(this.orderService.getComfortOrders().subscribe(r=>{null!=r&&(r.length<this.orders.length?this.orders=r:(e>=0&&e<=2&&setTimeout(()=>{this.orders=r},1e4),e>=2&&e<=4&&setTimeout(()=>{this.orders=r},8e3),e>=4&&e<=6&&setTimeout(()=>{this.orders=r},5e3),e>=6&&e<=8&&setTimeout(()=>{this.orders=r},3e3),e>=8&&e<=10&&setTimeout(()=>{this.orders=r},1e3)))}))}getClosestOrders(e){this.subscriptions.push(this.orderService.getAllOrders().subscribe(e=>{null!=e&&(this.calculateEta(e),this.driverService.categoryCloseCount=this.orders.length)}))}calculateClosest(){this.closeOrders=[],this.orders.forEach(e=>(0,a.mG)(this,void 0,void 0,function*(){const r=yield A.getCurrentPosition(),t={lat:r.coords.latitude,lng:r.coords.longitude},i={lat:e.locationLat,lng:e.locationLong};var s=new google.maps.LatLng(t.lat,t.lng),n=new google.maps.LatLng(i.lat,i.lng);this.distance=(google.maps.geometry.spherical.computeDistanceBetween(s,n)/1e3).toFixed(2),this.distance>5&&this.closeOrders.push(e),this.driverService.categoryCloseCount=this.closeOrders.length}))}calculateEta(e){this.orders=[],e.forEach(r=>(0,a.mG)(this,void 0,void 0,function*(){const t=yield A.getCurrentPosition(),i={lat:t.coords.latitude,lng:t.coords.longitude},s={lat:r.locationLat,lng:r.locationLong};var n=new google.maps.LatLng(i.lat,i.lng),o=new google.maps.LatLng(s.lat,s.lng);if(this.distance=function(e,r){return(google.maps.geometry.spherical.computeDistanceBetween(e,r)/1e3).toFixed(2)}(n,o),r.km=+this.distance,r.km>5){let t=e.indexOf(r);e.splice(t,1)}this.driverService.categoryCloseCount=e.length})),this.closeOrders=e,this.orders=e}openLanguagePopover(e){return(0,a.mG)(this,void 0,void 0,function*(){const r=yield this.popoverController.create({component:l.m,event:e});yield r.present()})}}return e.\u0275fac=function(r){return new(r||e)(p.Y36(o.F0),p.Y36(u.p),p.Y36(g.B),p.Y36(v.F),p.Y36(m.sK),p.Y36(n.Dh),p.Y36(f.g),p.Y36(O.I))},e.\u0275cmp=p.Xpm({type:e,selectors:[["app-driving"]],decls:27,vars:10,consts:[["slot","start"],["slot","end"],["id","toolbarIcon","name","language-outline",3,"click"],["padding","",1,"background"],[1,"row","mt-2"],[1,"col"],[1,"row"],[1,"col-md-12","text-center"],["color","dark",1,"centered"],[1,"text","list-group-item","list-group-item-action","flex-column","align-items-start"],[1,"fonted","blink_me"],[1,"d-flex","w-100","justify-content-between"],["class","col-md-10",4,"ngIf"],["class","row mt-2",4,"ngIf"],[1,"col-md-10"],["id","orderDiv","class","list-group mt-2",4,"ngFor","ngForOf"],["id","orderDiv",1,"list-group","mt-2"],[1,"mb-1","fonted"],["name","analytics-outline",1,"mr-2"],["name","arrow-forward-outline",1,"mr-2"],[1,"btn","btn-info",3,"routerLink"],[1,"fa","fa-calendar"],[1,"mt-1","text-center"],[1,"row","pl-3"],["name","person"],["type","button",1,"fonted","btn","btn-info",3,"click"]],template:function(e,r){1&e&&(p.TgZ(0,"ion-header"),p.TgZ(1,"ion-toolbar"),p.TgZ(2,"ion-buttons",0),p._UZ(3,"ion-menu-button"),p.qZA(),p.TgZ(4,"ion-title"),p.TgZ(5,"ion-label"),p._uU(6),p.ALo(7,"translate"),p.qZA(),p.qZA(),p.TgZ(8,"ion-buttons",1),p.TgZ(9,"ion-icon",2),p.NdJ("click",function(e){return r.openLanguagePopover(e)}),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.TgZ(10,"ion-content",3),p.TgZ(11,"div",4),p.TgZ(12,"div",5),p.TgZ(13,"div",6),p.TgZ(14,"div",7),p.TgZ(15,"ion-text",8),p.TgZ(16,"a",9),p.TgZ(17,"h2",10),p._uU(18),p.ALo(19,"translate"),p.qZA(),p._UZ(20,"hr"),p.TgZ(21,"div",11),p.TgZ(22,"small"),p._uU(23),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.YNc(24,b,2,1,"div",12),p.YNc(25,S,2,1,"div",12),p.qZA(),p.qZA(),p.qZA(),p.YNc(26,$,1,0,"div",13),p.qZA()),2&e&&(p.xp6(6),p.Oqu(p.lcZ(7,6,"Orders")),p.xp6(12),p.Oqu(p.lcZ(19,8,"Waiting for orders")),p.xp6(5),p.Oqu(r.message),p.xp6(1),p.Q6J("ngIf",!r.isSubOreder),p.xp6(1),p.Q6J("ngIf",r.isSubOreder),p.xp6(1),p.Q6J("ngIf",r.subOrders))},directives:[n.Gu,n.sr,n.Sm,n.fG,n.wd,n.Q$,n.gu,n.W2,n.yW,i.O5,i.sg,n.YI,o.rH],pipes:[m.X$,i.uU],styles:["ion-content[_ngcontent-%COMP%]{--ion-background-color:#e9e9e9}ion-toolbar[_ngcontent-%COMP%]{--ion-background-color:#eee}#map[_ngcontent-%COMP%]{height:100%;width:100%}ion-title[_ngcontent-%COMP%]{text-align:center}h5[_ngcontent-%COMP%]{font-size:.9em}#toolbarIcon[_ngcontent-%COMP%]{font-size:1.7em}.fonted[_ngcontent-%COMP%]{font-family:Open Sans Light}.centered[_ngcontent-%COMP%]{text-align:center}.text[_ngcontent-%COMP%]{font-family:Open Sans Light}hr[_ngcontent-%COMP%]{background:#eee;width:70%!important}.blink_me[_ngcontent-%COMP%]{-webkit-animation:blinker 1s linear infinite;animation:blinker 1s linear infinite}@-webkit-keyframes blinker{50%{opacity:0}}@keyframes blinker{50%{opacity:0}}.msg-box[_ngcontent-%COMP%]{width:100%;height:140px;padding:10px 30px;font-size:14px;font-family:Open Sans Light;overflow:auto}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:-5px;list-style:none}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .ex-msg[_ngcontent-%COMP%]{text-align:right}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .in-msg[_ngcontent-%COMP%]{text-align:left;margin-left:-60px}"]}),e})()}];let U=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({imports:[[o.Bz.forChild(x)],o.Bz]}),e})();var C=t(1841),q=t(2472),_=t(3577);function w(e){return new q.w(e)}let N=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=p.oAB({type:e}),e.\u0275inj=p.cJS({imports:[[i.ez,s.u5,n.Pc,U,m.aw.forChild({loader:{provide:m.Zw,useFactory:w,deps:[C.eN]}}),_.LanguagePopoverPageModule,s.UX]]}),e})()}}]);