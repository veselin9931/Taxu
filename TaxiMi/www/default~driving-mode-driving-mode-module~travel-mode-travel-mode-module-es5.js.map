{"version":3,"sources":["webpack:///src/_services/chat/chat.service.ts","webpack:///node_modules/@ionic-native/call-number/__ivy_ngcc__/ngx/index.js","webpack:///src/_services/trip/trip.service.ts"],"names":["ChatService","http","accountService","orderService","messages","connection","withUrl","signalRUrl","build","POST_URL","receivedMessageObject","sharedObj","on","user","message","mapReceivedMessage","stop","console","log","start","getOrderForChat","userValue","id","subscribe","x","currentOrderId","invoke","setTimeout","text","push","next","msgDto","post","asObservable","providedIn","CallNumber","_super","apply","arguments","prototype","callNumber","numberToCall","bypassAppChooser","isCallSupported","pluginName","plugin","pluginRef","repo","platforms","ɵfac","CallNumber_Factory","t","ɵCallNumber_BaseFactory","ɵprov","token","factory","ngDevMode","type","TripService","sharedService","trips","currentTripDriverId","currentOrder","data","headers","headerGerneration","currentTripOrderId","orderId","order","apiUrl","responseType","pipe","JSON","stringify","handleError","applicationUserId","get","trip","tripId","put","error","errorMessage","ErrorEvent","status"],"mappings":"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","file":"default~driving-mode-driving-mode-module~travel-mode-travel-mode-module-es5.js","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport * as signalR from '@aspnet/signalr';        // import signalR\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { Message } from '../../_models'\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { environment } from 'src/environments/environment';\r\nimport { AccountService } from '../account.service';\r\nimport { OrderService } from '../order/order.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class ChatService {\r\n  public messages = [];\r\n  private connection: any = new signalR.HubConnectionBuilder()\r\n    .withUrl(`${environment.signalRUrl}/orderHub`)\r\n    .build();\r\n\r\n  readonly POST_URL = `${environment.signalRUrl}/api/chat/send`;\r\n\r\n  private receivedMessageObject: Message = new Message();\r\n  private sharedObj = new Subject<Message>();\r\n\r\n  constructor(private http: HttpClient,\r\n    private accountService: AccountService,\r\n    private orderService: OrderService) {\r\n\r\n    // this.connection.onclose(async () => {\r\n    //   await this.start();\r\n    // });\r\n\r\n    this.connection.on(\"MessageReceived\", (user, message) => {\r\n      this.mapReceivedMessage(user, message);\r\n    });\r\n  }\r\n\r\n  public async stop() {\r\n    await this.connection.stop();\r\n    console.log('Disconnected')\r\n  }\r\n\r\n  // Start the connection\r\n  public async start() {\r\n    try {\r\n      await this.connection.start();\r\n\r\n      await this.orderService.getOrderForChat(this.accountService.userValue.id)\r\n        .subscribe(x => {\r\n          if (this.orderService.currentOrderId) {\r\n            this.connection.invoke(\"AddToRoom\", this.orderService.currentOrderId);\r\n          } else {\r\n            if (x == null) {\r\n            } else {\r\n              this.connection.invoke(\"AddToRoom\", x.id);\r\n            }\r\n          }\r\n        });\r\n\r\n      console.log(\"connected in chat\");\r\n    } catch (err) {\r\n      console.log(err);\r\n      console.log(\"Reoonnecting in 1 sec.\");\r\n      setTimeout(() => this.start(), 1000);\r\n    }\r\n  }\r\n\r\n  private mapReceivedMessage(user: string, message: string): void {\r\n    this.receivedMessageObject.user = user;\r\n    this.receivedMessageObject.text = message;\r\n    this.messages.push(this.receivedMessageObject);\r\n    this.sharedObj.next(this.receivedMessageObject);\r\n  }\r\n\r\n  public broadcastMessage(msgDto: any) {\r\n    this.orderService.getOrderForChat(this.accountService.userValue.id)\r\n      .subscribe(x => {\r\n        if (x.id) {\r\n          this.http.post(`${this.POST_URL}/${x.id}`, msgDto).subscribe(() => { });\r\n        }\r\n      });\r\n  }\r\n\r\n  public retrieveMappedObject(): Observable<Message> {\r\n    return this.sharedObj.asObservable();\r\n  }\r\n\r\n}\r\n","import { __extends } from \"tslib\";\nimport { Injectable } from '@angular/core';\nimport { IonicNativePlugin, cordova } from '@ionic-native/core';\nimport * as ɵngcc0 from '@angular/core';\nvar CallNumber = /** @class */ (function (_super) {\n    __extends(CallNumber, _super);\n    function CallNumber() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    CallNumber.prototype.callNumber = function (numberToCall, bypassAppChooser) { return cordova(this, \"callNumber\", { \"callbackOrder\": \"reverse\" }, arguments); };\n    CallNumber.prototype.isCallSupported = function () { return cordova(this, \"isCallSupported\", {}, arguments); };\n    CallNumber.pluginName = \"CallNumber\";\n    CallNumber.plugin = \"call-number\";\n    CallNumber.pluginRef = \"plugins.CallNumber\";\n    CallNumber.repo = \"https://github.com/Rohfosho/CordovaCallNumberPlugin\";\n    CallNumber.platforms = [\"Android\", \"iOS\"];\nCallNumber.ɵfac = function CallNumber_Factory(t) { return ɵCallNumber_BaseFactory(t || CallNumber); };\nCallNumber.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: CallNumber, factory: function (t) { return CallNumber.ɵfac(t); } });\nvar ɵCallNumber_BaseFactory = /*@__PURE__*/ ɵngcc0.ɵɵgetInheritedFactory(CallNumber);\n(function () { (typeof ngDevMode === \"undefined\" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CallNumber, [{\n        type: Injectable\n    }], null, null); })();\n    return CallNumber;\n}(IonicNativePlugin));\nexport { CallNumber };\n\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9AaW9uaWMtbmF0aXZlL3BsdWdpbnMvY2FsbC1udW1iZXIvbmd4L2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sOEJBQXNDLE1BQU0sb0JBQW9CLENBQUM7O0FBQ3hFO0FBSVUsSUEwQnNCLDhCQUFpQjtBQUFDO0FBRTlCO0FBQytDO0FBQ2pFLElBTUEsK0JBQVUsYUFBQyxZQUFvQixFQUFFLGdCQUF5QjtBQU12RCxJQUdILG9DQUFlO0FBSXNCO0FBQTBDO0FBQXVDO0FBQWlEO0FBQTZFOzhDQXhCclAsVUFBVTs7Ozs7MEJBQ0w7QUFBQyxxQkFoQ1A7QUFBRSxFQWdDOEIsaUJBQWlCO0FBQ2hELFNBRFksVUFBVTtBQUFJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29yZG92YSwgSW9uaWNOYXRpdmVQbHVnaW4sIFBsdWdpbiB9IGZyb20gJ0Bpb25pYy1uYXRpdmUvY29yZSc7XG5cbi8qKlxuICogQG5hbWUgQ2FsbCBOdW1iZXJcbiAqIEBkZXNjcmlwdGlvblxuICogQ2FsbCBhIG51bWJlciBkaXJlY3RseSBmcm9tIHlvdXIgQ29yZG92YS9Jb25pYyBhcHBsaWNhdGlvbi5cbiAqICoqTk9URSoqOiBUaGUgaU9TIFNpbXVsYXRvciAoYW5kIG1heWJlIEFuZHJvaWQgU2ltdWxhdG9ycykgZG8gbm90IHByb3ZpZGUgYWNjZXNzIHRvIHRoZSBwaG9uZSBzdWJzeXN0ZW0uXG4gKlxuICogQHVzYWdlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBDYWxsTnVtYmVyIH0gZnJvbSAnQGlvbmljLW5hdGl2ZS9jYWxsLW51bWJlci9uZ3gnO1xuICpcbiAqIGNvbnN0cnVjdG9yKHByaXZhdGUgY2FsbE51bWJlcjogQ2FsbE51bWJlcikgeyB9XG4gKlxuICogLi4uXG4gKlxuICpcbiAqIHRoaXMuY2FsbE51bWJlci5jYWxsTnVtYmVyKFwiMTgwMDEwMTAxMDFcIiwgdHJ1ZSlcbiAqICAgLnRoZW4ocmVzID0+IGNvbnNvbGUubG9nKCdMYXVuY2hlZCBkaWFsZXIhJywgcmVzKSlcbiAqICAgLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZygnRXJyb3IgbGF1bmNoaW5nIGRpYWxlcicsIGVycikpO1xuICpcbiAqIGBgYFxuICovXG5AUGx1Z2luKHtcbiAgcGx1Z2luTmFtZTogJ0NhbGxOdW1iZXInLFxuICBwbHVnaW46ICdjYWxsLW51bWJlcicsXG4gIHBsdWdpblJlZjogJ3BsdWdpbnMuQ2FsbE51bWJlcicsXG4gIHJlcG86ICdodHRwczovL2dpdGh1Yi5jb20vUm9oZm9zaG8vQ29yZG92YUNhbGxOdW1iZXJQbHVnaW4nLFxuICBwbGF0Zm9ybXM6IFsnQW5kcm9pZCcsICdpT1MnXSxcbn0pXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQ2FsbE51bWJlciBleHRlbmRzIElvbmljTmF0aXZlUGx1Z2luIHtcbiAgLyoqXG4gICAqIENhbGxzIGEgcGhvbmUgbnVtYmVyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBudW1iZXJUb0NhbGwgVGhlIHBob25lIG51bWJlciB0byBjYWxsIGFzIGEgc3RyaW5nXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gYnlwYXNzQXBwQ2hvb3NlciBTZXQgdG8gdHJ1ZSB0byBieXBhc3MgdGhlIGFwcCBjaG9vc2VyIGFuZCBnbyBkaXJlY3RseSB0byBkaWFsZXJcbiAgICogQHJldHVybiB7UHJvbWlzZTxhbnk+fVxuICAgKi9cbiAgQENvcmRvdmEoe1xuICAgIGNhbGxiYWNrT3JkZXI6ICdyZXZlcnNlJyxcbiAgfSlcbiAgY2FsbE51bWJlcihudW1iZXJUb0NhbGw6IHN0cmluZywgYnlwYXNzQXBwQ2hvb3NlcjogYm9vbGVhbik6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGNhbGwgZmVhdHVyZSBpcyBhdmFpbGFibGVcbiAgICogQHJldHVybiB7UHJvbWlzZTxhbnk+fVxuICAgKi9cbiAgQENvcmRvdmEoKVxuICBpc0NhbGxTdXBwb3J0ZWQoKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm47XG4gIH1cbn1cbiJdfQ==","import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { Observable, throwError } from 'rxjs';\r\nimport { catchError, tap } from 'rxjs/operators';\r\nimport { environment } from 'src/environments/environment';\r\nimport { Trip } from 'src/_models';\r\nimport { AccountService } from '../account.service';\r\nimport { SharedService } from '../shared/shared.service';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class TripService {\r\n  public trip: Trip;\r\n  public trips = [];\r\n  public currentTripOrderId: string;\r\n  public currentTripDriverId = this.accountService.userValue.id;\r\n  public currentOrder = \"\";\r\n  \r\n  constructor(private http: HttpClient, private accountService: AccountService, private sharedService: SharedService) { }\r\n\r\n  public createTrip(data) {\r\n    const headers = this.sharedService.headerGerneration();\r\n    this.currentTripOrderId = data.orderId;\r\n    this.currentOrder = data.order;\r\n\r\n    return this.http.post(`${environment.apiUrl}/api/trip`, data,  { headers, responseType: 'text' })\r\n      .pipe(\r\n        tap(data => console.log('created trip: ', JSON.stringify(data))),\r\n        catchError(this.handleError)\r\n      );\r\n  }\r\n\r\n  getTrip(applicationUserId: string): Observable<Trip> {\r\n    const headers = this.sharedService.headerGerneration();\r\n    return this.http.get<Trip>(`${environment.apiUrl}/api/trip/${applicationUserId}`, {headers})\r\n      .pipe(\r\n        tap(data => this.trip = data),\r\n        catchError(this.handleError)\r\n      )\r\n  }\r\n\r\n  startTrip(tripId: string): Observable<Trip> {\r\n    return this.http.put<Trip>(`${environment.apiUrl}/api/trip/start/${tripId}`, {  responseType: 'json' },)\r\n      .pipe(\r\n        catchError(this.handleError)\r\n      );\r\n\r\n  }\r\n\r\n  navigateToUser(tripId: string, orderId: string): Observable<Trip> {\r\n    return this.http.put<Trip>(`${environment.apiUrl}/api/trip/navigate/${tripId}/${orderId}`, {  responseType: 'json' },)\r\n      .pipe(\r\n        catchError(this.handleError)\r\n      );\r\n\r\n  }\r\n\r\n  cancelTrip(tripId: string): Observable<Trip> {\r\n    return this.http.put<Trip>(`${environment.apiUrl}/api/trip/cancel/${tripId}`, { responseType: 'json' },)\r\n      .pipe(\r\n        catchError(this.handleError)\r\n      );\r\n  }\r\n\r\n\r\n  completeTrip(tripId: string): Observable<Trip> {\r\n    return this.http.put<Trip>(`${environment.apiUrl}/api/trip/finish/${tripId}`, { responseType: 'json' },)\r\n      .pipe(\r\n        catchError(this.handleError)\r\n      );\r\n\r\n  }\r\n\r\n\r\n  handleError(error) {\r\n    let errorMessage = '';\r\n    if (error.error instanceof ErrorEvent) {\r\n      // client-side error\r\n      console.log('Client side error.')\r\n      errorMessage = `Error: ${error.error.message}`;\r\n    } else {\r\n      // server-side error\r\n      console.log('Server side error.')\r\n      errorMessage = `Error Code: ${error.status}\\nMessage: ${error.message}`;\r\n    }\r\n    console.log(errorMessage);\r\n    return throwError(errorMessage);\r\n  }\r\n}\r\n"]}