(self.webpackChunkcsharpcornerauthor=self.webpackChunkcsharpcornerauthor||[]).push([[7877],{297:function(e,r,t){"use strict";t.d(r,{p:function(){return h}});var i=t(205),s=t(5304),o=t(3342),n=t(2340),a=t(3018),c=t(1841),d=t(728);let h=(()=>{class e{constructor(e,r){this.http=e,this.sharedService=r,this.orders=[],this.completedOrder=!1}createOrder(e){const r=this.sharedService.headerGerneration();return this.http.post(`${n.N.apiUrl}/api/order`,e,{headers:r,responseType:"text"}).pipe((0,s.K)(this.handleError))}addToFavourites(e){const r=this.sharedService.headerGerneration();return this.http.post(`${n.N.apiUrl}/api/order/favourites`,e,{headers:r,responseType:"text"}).pipe((0,s.K)(this.handleError))}getMyFavourites(e){const r=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/favourites/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}deleteFavouriteOrder(e){const r=this.sharedService.headerGerneration();return this.http.delete(`${n.N.apiUrl}/api/order/favourites/${e}`,{headers:r}).pipe((0,o.b)(e=>console.log("deleted favourite order: ",JSON.stringify(e))),(0,s.K)(this.handleError))}getDirections(e,r,t,i){const o=this.sharedService.headerGerneration();return this.http.post(`https://maps.googleapis.com/maps/api/distancematrix/json?units=imperial&origins=${e},${r}&destinations=${t}%2C${i}%7C&key=AIzaSyAEvlXdM4joG4bNVT5l-tJSk9lUSGhxMNw`,{headers:o,responseType:"text"}).pipe((0,s.K)(this.handleError))}getOrderById(e){const r=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/id/${e}`,{headers:r}).pipe((0,o.b)(e=>this.order=e))}getCanceledOrderById(e){const r=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/canceled/${e}`,{headers:r}).pipe((0,o.b)(e=>this.order=e))}getLastCompletedOrder(e){const r=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/completed/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}getMyOrder(e){const r=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}getOrderForChat(e){const r=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/chat/${e}`,{headers:r}).pipe((0,s.K)(this.handleError))}getAllOrders(){const e=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order`,{headers:e}).pipe((0,s.K)(this.handleError))}getNormalOrders(){const e=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/normal`,{headers:e}).pipe((0,s.K)(this.handleError))}getComfortOrders(){const e=this.sharedService.headerGerneration();return this.http.get(`${n.N.apiUrl}/api/order/comfort`,{headers:e}).pipe((0,s.K)(this.handleError))}acceptOrder(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,o.b)(e=>this.driverId=r),(0,s.K)(this.handleError))}updateOrderEta(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/eta/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,s.K)(this.handleError))}updateDriverArrived(e){const r=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/arrived/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}rateOrder(e){const r=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/rate/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}increaseOrderPrice(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/increase/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,s.K)(this.handleError))}completeOrder(e){const r=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}deleteOrder(e){const r=this.sharedService.headerGerneration();return this.http.delete(`${n.N.apiUrl}/api/order/${e}`,{headers:r}).pipe((0,o.b)(e=>console.log("deleted order: ",JSON.stringify(e))),(0,s.K)(this.handleError))}driverIncreaseOrderPrice(e,r,t){const i=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/increased/${e}/${r}/${t}`,{headers:i,responseType:"json"}).pipe((0,s.K)(this.handleError))}resetIncreasing(e){const r=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/reset/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}increasedOrderAccept(e,r){const t=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/accepted/increase/${e}/${r}`,{headers:t,responseType:"json"}).pipe((0,s.K)(this.handleError))}incrementOrderPrice(e){const r=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/increment/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}decrementOrderPrice(e){const r=this.sharedService.headerGerneration();return this.http.put(`${n.N.apiUrl}/api/order/decrement/${e}`,{headers:r,responseType:"json"}).pipe((0,s.K)(this.handleError))}handleError(e){let r="";return e.error instanceof ErrorEvent?(console.log("Client side error."),r=`Error: ${e.error.message}`):(console.log("Server side error."),r=`Error Code: ${e.status}\nMessage: ${e.message}`),console.log(r),(0,i._)(r)}}return e.\u0275fac=function(r){return new(r||e)(a.LFG(c.eN),a.LFG(d.F))},e.\u0275prov=a.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},7877:function(e,r,t){"use strict";t.r(r),t.d(r,{HttpLoaderFactory:function(){return P},TravelModePageModule:function(){return M}});var i=t(8583),s=t(3679),o=t(7823),n=t(4481),a=t(4762),c=t(3018),d=t(4426),h=t(2340),l=t(6522),p=t(297),u=t(5056),g=t(1177),v=t(1799),m=t(7324),b=t(791),f=t(7800),S=t(4687);const y=["map"];function O(e,r){if(1&e&&(c.TgZ(0,"p"),c._uU(1),c.ALo(2,"translate"),c.ALo(3,"date"),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.lnq(" ",c.lcZ(2,3,"Price"),": ",e.totalPrice," \u043b\u0432. | ",c.xi3(3,5,1e3*e.secsDiff,"mm:ss")," ")}}function C(e,r){if(1&e&&(c.TgZ(0,"p"),c._uU(1),c.ALo(2,"translate"),c.qZA()),2&e){const e=c.oxw();c.xp6(1),c.AsE(" ",c.lcZ(2,2,"Price"),": ",e.totalPrice," \u043b\u0432. ")}}const T=[{path:"",component:(()=>{class e{constructor(e,r,t,i,s,o,n,a,c,d,h){this.route=e,this.orderService=r,this.accountService=t,this.tripService=i,this.driverService=s,this.localNotifications=o,this.alertController=n,this.chatService=a,this.translate=c,this.popoverController=d,this.callNumber=h,this.user=this.accountService.userValue,this.driverId=this.accountService.userValue.driverId,this.carModel="",this.carColor="",this.firstName="",this.lastName="",this.chatStyle="",this.subscriptions=[],this.maxTime=3e4,this.translate.setDefaultLang(this.accountService.userValue.choosenLanguage)}ngOnInit(){this.checkorder();const e=(new d.su).configureLogging(d.in.Information).withUrl(`${h.N.signalRUrl}/orderHub`).build();e.start().then(function(){console.log("signalR Connected in travel-mode")}).catch(function(r){console.log("Reconnecting in 1 sec."),setTimeout(()=>e.start(),1e3)}),e.on("BroadcastMessage",()=>{this.checkorder()}),e.on("StartTrip",()=>{this.checkorder()}),e.on("Navigate",()=>{this.checkorder()}),e.on("OrderAccepted",e=>{this.subscriptions.push(this.orderService.getOrderById(e).subscribe(e=>{e.id==this.order.id&&"Accepted"==e.status&&this.presentOrderAcceptedNotification()}))}),e.on("OrderWaiting",e=>{this.subscriptions.push(this.orderService.getMyOrder(this.user.id).subscribe(r=>{r.id==e&&this.canceledOrder()}))}),e.on("LocateDriver",e=>{this.subscriptions.push(this.orderService.getMyOrder(this.user.id).subscribe(r=>{this.subscriptions.push(this.driverService.getDriver(e).subscribe(r=>{r.id==e&&this.loadMap(this.mapRef,r.applicationUserId)}))}))}),e.on("NotifyArrived",e=>{this.subscriptions.push(this.orderService.getOrderById(e).subscribe(r=>{1==r.isDriverArrived&&this.order.id==e&&(this.presentDriverArrivedNotification(),this.accountService.userValue.alertTriggered=!0,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!0).subscribe(()=>{})),this.accountService.userValue.timer=new Date,60==this.seconds&&(this.seconds=0),this.startTimer())}))}),e.on("CompleteOrder",e=>{this.order.id==e&&(this.accountService.userValue.alertTriggered=!1,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!1).subscribe(()=>{})),this.completedOrderAlert())})}ionViewDidEnter(){this.checkorder(),1==this.accountService.userValue.alertTriggered&&this.startTimer()}checkorder(){this.subscriptions.push(this.orderService.getMyOrder(this.user.id).subscribe(e=>{e?(this.totalPrice=e.totalPrice,this.orderStatus=e.status,this.orderAcceptedBy=e.acceptedBy,this.orderService.currentOrderId=e.id,this.location=e.location,this.destination=e.destination,(Math.round(100*this.orderTotalPrice)/100).toFixed(2),this.orderTotalPrice=e.totalPrice,this.order=e,this.estimatedDuration=e.eta,null!=e.acceptedBy&&(this.getUserById(e.acceptedBy),this.getAcceptedTrip(e.acceptedBy),this.driverId=e.acceptedBy)):(this.accountService.userValue.alertTriggered=!1,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!1).subscribe(()=>{})),this.orderTotalPrice=0)},e=>{console.log(e)}))}startTimer(){this.startTime=new Date(this.accountService.userValue.timer),setInterval(()=>{300==this.secsDiff&&this.subscriptions.push(this.orderService.increaseOrderPrice(this.order.id,.5).subscribe(()=>{})),this.secsDiff>=300&&this.secsDiff%60==59&&(console.log("time to up"),this.subscriptions.push(this.orderService.increaseOrderPrice(this.order.id,.5).subscribe(()=>{}))),this.secsDiff=(new Date).getTime()-this.startTime.getTime(),this.secsDiff=Math.floor(this.secsDiff/1e3)},1e3)}presentOrderAcceptedNotification(){this.translate.get(["Order","Your order is accepted"]).subscribe(e=>{this.localNotifications.schedule({id:1,title:e.Order,text:e["Your order is accepted"],data:{secret:"secret"}})})}presentDriverArrivedNotification(){this.translate.get(["Order","Your driver is on the address, free waiting time 5min"]).subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){this.localNotifications.schedule({id:2,title:e.Order,text:e["Your driver is on the address, free waiting time 5min"],data:{secret:"secret"}})}))}getUserById(e){this.subscriptions.push(this.accountService.getById(e).subscribe(e=>{this.firstName=e.firstName,this.lastName=e.lastName,this.driverId=e.driverId,this.phoneNumber=e.phone,this.subscriptions.push(this.driverService.getDriverActiveCar(e.driverId).subscribe(e=>{this.carModel=e.model,this.carColor=e.color}))}))}callDriver(){let e=this.phoneNumber.toString();this.callNumber.callNumber(e,!0).then(e=>console.log("Launched dialer!",e)).catch(e=>console.log("Error launching dialer",e))}getAcceptedTrip(e){this.subscriptions.push(this.tripService.getTrip(e).subscribe(r=>{null!=r?(this.tripStatus=r.status,"Started"==r.status&&(this.accountService.userValue.alertTriggered=!1,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!1).subscribe(()=>{}))),this.currentTrip=r,this.loadMap(this.mapRef,e)):console.log("No trip!")}))}addToFavourite(){let e={applicationUserId:this.order.applicationUserId,location:this.order.location,locationLat:this.order.locationLat,locationLong:this.order.locationLong,destination:this.order.destination,destinationLat:this.order.destinationLat,destinationLong:this.order.destinationLong,totalPrice:this.order.totalPrice};e?this.subscriptions.push(this.orderService.addToFavourites(e).subscribe(()=>{this.successAddedFavourite()})):console.log("Problem with data occured")}loadMap(e,r){return(0,a.mG)(this,void 0,void 0,function*(){this.subscriptions.push(this.accountService.getById(r).subscribe(r=>{this.subscriptions.push(this.driverService.getDriver(r.driverId).subscribe(r=>{const t={lat:+r.currentLocationLat,lng:+r.currentLocationLong},i={center:new google.maps.LatLng(t.lat,t.lng),zoom:15,disableDefaultUI:!0};null!=e&&(this.map=new google.maps.Map(e.nativeElement,i));var s={url:"https://images.vexels.com/media/users/3/154573/isolated/preview/bd08e000a449288c914d851cb9dae110-hatchback-car-top-view-silhouette-by-vexels.png",scaledSize:new window.google.maps.Size(25,25),anchor:{x:10,y:10}};new google.maps.Marker({position:new google.maps.LatLng(t),icon:s,map:this.map})}))}))})}cancelTrip(){return(0,a.mG)(this,void 0,void 0,function*(){this.alertForCancel()})}alertForCancel(){return(0,a.mG)(this,void 0,void 0,function*(){this.translate.get(["Are you sure you want to cancel the order?","Your rating will decrease!","Confirm","Cancel"]).subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){const r=yield this.alertController.create({header:e["Are you sure you want to cancel the order?"],message:e["Your rating will decrease!"],buttons:[{text:e.Cancel},{text:e.Confirm,handler:()=>{this.subscriptions.push(this.tripService.getTrip(this.orderAcceptedBy).subscribe(e=>{this.subscriptions.push(this.tripService.cancelTrip(e.id).subscribe(r=>{this.subscriptions.push(this.accountService.updateDriving(this.orderAcceptedBy,!1).subscribe(()=>{})),this.accountService.userValue.isDrivingNow=!1,this.subscriptions.push(this.orderService.deleteOrder(e.orderId).subscribe(()=>this.route.navigate(["menu/travelling"])))}))}))}}]});yield r.present()}))})}openLanguagePopover(e){return(0,a.mG)(this,void 0,void 0,function*(){const r=yield this.popoverController.create({component:l.m,event:e});yield r.present()})}completedOrderAlert(){return(0,a.mG)(this,void 0,void 0,function*(){this.translate.get(["You have reached the final destination! Did you enjoyed the trip?","Yes","No","Cancel","Report a problem"]).subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){const r=yield this.alertController.create({cssClass:"my-custom-class",header:e["You have reached the final destination! Did you enjoyed the trip?"],buttons:[{text:e.Yes,role:"cancel",handler:()=>{this.subscriptions.push(this.driverService.voteUp(this.driverId).subscribe(e=>{})),this.route.navigate(["menu/travelling"])}},{text:e.No,role:"no",handler:()=>{this.subscriptions.push(this.driverService.voteDown(this.driverId).subscribe(e=>{})),this.route.navigate(["menu/travelling"])}},{text:e.Cancel,role:"cancel",handler:()=>{this.route.navigate(["menu/travelling"])}},{text:e["Report a problem"],role:"cancel",handler:()=>{this.route.navigate(["menu/report"])}}]});this.route.navigate(["menu/travelling"]),yield r.present()}))})}successAddedFavourite(){return(0,a.mG)(this,void 0,void 0,function*(){this.translate.get(["Successfully added to favourites!","Cancel"]).subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){const r=yield this.alertController.create({header:e["Successfully added to favourites!"],buttons:[{text:e.Cancel,role:"cancel"}]});yield r.present()}))})}canceledOrder(){return(0,a.mG)(this,void 0,void 0,function*(){this.translate.get(["Order is cancelled by the driver."]).subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){const r=yield this.alertController.create({header:e["Order is cancelled by the driver."],buttons:[{text:"Ok",handler:()=>{this.route.navigate(["menu/travelling"])}}]});yield r.present()}))})}}return e.\u0275fac=function(r){return new(r||e)(c.Y36(n.F0),c.Y36(p.p),c.Y36(u.B),c.Y36(g.a),c.Y36(v.F),c.Y36(m.sn),c.Y36(o.Br),c.Y36(b.a),c.Y36(f.sK),c.Y36(o.Dh),c.Y36(S.X))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-travel-mode"]],viewQuery:function(e,r){if(1&e&&c.Gf(y,1,c.SBq),2&e){let e;c.iGM(e=c.CRH())&&(r.mapRef=e.first)}},decls:34,vars:20,consts:[["slot","start"],[1,"blink_me"],["slot","end"],["id","toolbarIcon","name","language-outline",3,"click"],["id","map"],["map",""],[1,"row"],[1,"col"],[1,"list-group"],[1,"list-group-item","list-group-item-action","flex-column","align-items-start"],["name","analytics-outline",1,"mr-2"],[1,"d-flex","w-100","justify-content-between"],[4,"ngIf"],["type","button",1,"fonted","btn","btn-warning","mb-1",3,"click"],["name","call",1,"mr-2"]],template:function(e,r){1&e&&(c.TgZ(0,"ion-content"),c.TgZ(1,"ion-header"),c.TgZ(2,"ion-toolbar"),c.TgZ(3,"ion-buttons",0),c._UZ(4,"ion-menu-button"),c.qZA(),c.TgZ(5,"ion-title"),c.TgZ(6,"ion-label",1),c._uU(7),c.ALo(8,"translate"),c.qZA(),c.qZA(),c.TgZ(9,"ion-buttons",2),c.TgZ(10,"ion-icon",3),c.NdJ("click",function(e){return r.openLanguagePopover(e)}),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c._UZ(11,"div",4,5),c.qZA(),c.TgZ(13,"ion-footer"),c.TgZ(14,"div",6),c.TgZ(15,"div",7),c.TgZ(16,"div",8),c.TgZ(17,"a",9),c.TgZ(18,"p"),c._uU(19),c.ALo(20,"translate"),c.ALo(21,"translate"),c.qZA(),c._UZ(22,"hr"),c.TgZ(23,"p"),c._UZ(24,"ion-icon",10),c._uU(25),c.qZA(),c._UZ(26,"hr"),c.TgZ(27,"div",11),c.YNc(28,O,4,8,"p",12),c.YNc(29,C,3,4,"p",12),c.TgZ(30,"button",13),c.NdJ("click",function(){return r.callDriver()}),c._UZ(31,"ion-icon",14),c._uU(32),c.ALo(33,"translate"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e&&(c.xp6(7),c.Oqu(c.lcZ(8,12,"Waiting for the car")),c.xp6(12),c.Q0o("",r.firstName," ",r.lastName," ",c.lcZ(20,14,"will arrive with")," ",r.carColor," ",r.carModel," ",c.lcZ(21,16,"in about")," ",r.estimatedDuration,"."),c.xp6(6),c.hij("",r.destination," "),c.xp6(3),c.Q6J("ngIf",1==r.accountService.userValue.alertTriggered),c.xp6(1),c.Q6J("ngIf",0==r.accountService.userValue.alertTriggered),c.xp6(3),c.hij("",c.lcZ(33,18,"Call driver")," "))},directives:[o.W2,o.Gu,o.sr,o.Sm,o.fG,o.wd,o.Q$,o.gu,o.fr,i.O5],pipes:[f.X$,i.uU],styles:["ion-content[_ngcontent-%COMP%]{--ion-background-color:#353535}ion-toolbar[_ngcontent-%COMP%]{--ion-background-color:#eee}ion-title[_ngcontent-%COMP%]{text-align:center}#marker[_ngcontent-%COMP%]{position:absolute;background:url(http://maps.gstatic.com/mapfiles/markers2/marker.png) no-repeat;top:50%;left:50%;z-index:1;margin-left:-10px;margin-top:-34px;height:34px;width:20px;cursor:pointer}#map[_ngcontent-%COMP%]{height:100%;width:100%}#toolbarIcon[_ngcontent-%COMP%]{font-size:1.7em}.centered[_ngcontent-%COMP%]{text-align:center}.textTravel[_ngcontent-%COMP%]{font-size:1.5em}.text[_ngcontent-%COMP%], .textTravel[_ngcontent-%COMP%]{font-family:Open Sans Light}.text[_ngcontent-%COMP%]{font-size:2.4em}i[_ngcontent-%COMP%]{color:#eee}.my-custom-class[_ngcontent-%COMP%]{--background:#e5e5e5}.checkbox-icon[_ngcontent-%COMP%]{color:#fff}ion-checkbox[_ngcontent-%COMP%]{--border-color:#fff}ion-select[_ngcontent-%COMP%]{color:#383838;background-color:#fff;border-radius:10px;border:3px solid #eee}.blink_me[_ngcontent-%COMP%]{-webkit-animation:blinker 1s linear infinite;animation:blinker 1s linear infinite}@-webkit-keyframes blinker{50%{opacity:0}}@keyframes blinker{50%{opacity:0}}.backIcon[_ngcontent-%COMP%]{font-size:150%}.back[_ngcontent-%COMP%], .backIcon[_ngcontent-%COMP%]{color:#ffae00}.fonted[_ngcontent-%COMP%], .msg-box[_ngcontent-%COMP%]{font-family:Open Sans Light}.msg-box[_ngcontent-%COMP%]{width:100%;height:140px;padding:10px 30px;font-size:14px;overflow:auto}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:-5px;list-style:none}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .ex-msg[_ngcontent-%COMP%]{text-align:right}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .in-msg[_ngcontent-%COMP%]{text-align:left;margin-left:-60px}"]}),e})()}];let x=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[n.Bz.forChild(T)],n.Bz]}),e})();var N=t(1841),$=t(2472),A=t(3577);function P(e){return new $.w(e)}let M=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[S.X],imports:[[i.ez,s.u5,o.Pc,x,f.aw.forChild({loader:{provide:f.Zw,useFactory:P,deps:[N.eN]}}),A.LanguagePopoverPageModule]]}),e})()}}]);