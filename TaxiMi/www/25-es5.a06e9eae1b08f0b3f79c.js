!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{tIIa:function(n,r,i){"use strict";i.r(r),i.d(r,"HttpLoaderFactory",function(){return X}),i.d(r,"OrderDetailsPageModule",function(){return E});var o=i("ofXK"),c=i("3Pt+"),a=i("TEn/"),s=i("tyNb"),l=i("mrSG"),u=i("fXoL"),d=i("Gpoy"),b=i("gcOT"),p=i("AytR"),f=i("oXKM"),g=i("sYmb"),m=i("8Xdb"),h=i("8k+r"),v=i("exMm"),y=i("Hmjx"),w=i("e7jj"),M=["map"];function k(e,t){if(1&e){var n=u.Ob();u.Nb(0,"button",24),u.Vb("click",function(){return u.jc(n),u.Xb().showMap()}),u.pc(1),u.Yb(2,"translate"),u.Mb()}2&e&&(u.zb(1),u.qc(u.Zb(2,1,"Show map")))}function I(e,t){if(1&e){var n=u.Ob();u.Nb(0,"button",24),u.Vb("click",function(){return u.jc(n),u.Xb().hideMap()}),u.pc(1),u.Yb(2,"translate"),u.Mb()}2&e&&(u.zb(1),u.qc(u.Zb(2,1,"Show details")))}function O(e,t){1&e&&u.Lb(0,"ion-icon",25)}function N(e,t){if(1&e&&(u.Nb(0,"small",26),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e){var n=u.Xb();u.zb(1),u.sc("",u.Zb(2,2,"Pickup time")," ",n.order.pickUpTime,"")}}function x(e,t){1&e&&(u.Nb(0,"small"),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.rc("",u.Zb(2,1,"Additional options"),":"))}function C(e,t){1&e&&(u.Nb(0,"li"),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.qc(u.Zb(2,1,"Pets")))}function D(e,t){1&e&&(u.Nb(0,"li"),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.qc(u.Zb(2,1,"Baggage")))}function P(e,t){1&e&&(u.Nb(0,"li"),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.qc(u.Zb(2,1,"Special needs")))}function L(e,t){1&e&&(u.Nb(0,"small"),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.rc("",u.Zb(2,1,"Desired car type"),":"))}function S(e,t){if(1&e&&(u.Nb(0,"ul"),u.Nb(1,"li"),u.pc(2),u.Mb(),u.Mb()),2&e){var n=u.Xb();u.zb(2),u.qc(n.order.carType)}}function z(e,t){1&e&&(u.Nb(0,"small"),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.rc("",u.Zb(2,1,"Additional requirements"),":"))}function R(e,t){if(1&e&&(u.Nb(0,"ul"),u.Nb(1,"li"),u.pc(2),u.Mb(),u.Mb()),2&e){var n=u.Xb();u.zb(2),u.qc(n.order.description)}}function T(e,t){1&e&&(u.Nb(0,"p",27),u.pc(1),u.Yb(2,"translate"),u.Mb()),2&e&&(u.zb(1),u.qc(u.Zb(2,1,"Offer more price to order")))}function V(e,t){if(1&e){var n=u.Ob();u.Nb(0,"div",9),u.Nb(1,"button",28),u.Vb("click",function(){return u.jc(n),u.Xb().offer(1)}),u.pc(2,"+1\u043b\u0432"),u.Mb(),u.Nb(3,"button",28),u.Vb("click",function(){return u.jc(n),u.Xb().offer(2)}),u.pc(4,"+2\u043b\u0432"),u.Mb(),u.Nb(5,"button",28),u.Vb("click",function(){return u.jc(n),u.Xb().offer(3)}),u.pc(6,"+3\u043b\u0432"),u.Mb(),u.Nb(7,"button",28),u.Vb("click",function(){return u.jc(n),u.Xb().offer(4)}),u.pc(8,"+4\u043b\u0432"),u.Mb(),u.Nb(9,"button",28),u.Vb("click",function(){return u.jc(n),u.Xb().offer(5)}),u.pc(10,"+5\u043b\u0432"),u.Mb(),u.Mb()}}var j,A,_=b.c.Geolocation,Y=[{path:"",component:(j=function(){function n(t,r,i,o,c,a,s,l,u,d){e(this,n),this.translate=t,this.popoverController=r,this.accountService=i,this.router=o,this.route=c,this.orderService=a,this.driverService=s,this.walletService=l,this.tripService=u,this.alertController=d,this.orderId=this.route.snapshot.params.id,this.applicationUserId=this.accountService.userValue.id,this.isDrivingNow=this.accountService.userValue.isDrivingNow,this.order={id:"",location:"",locationLat:"",locationLong:"",destination:"",destinationLat:"",destinationLong:"",increasePrice:"",isAccepted:null,isCompleted:null,createdOn:null,status:null,applicationUser:null,applicationUserId:null,totalPrice:null,acceptedBy:null,tripDistance:null,userDistance:null,withPets:null,withStroller:null,carType:null,isRated:null,km:null,distanceText:null,eta:null,isDeleted:null,isDriverArrived:null,increasedByDriver:null,increaseAccepted:null,increasedBy:null,special:null,pickUpTime:null,description:null},this.mapVisible=!1,this.subscriptions=[],this.translate.setDefaultLang(this.accountService.userValue.choosenLanguage)}var r,i,o;return r=n,(i=[{key:"ngOnInit",value:function(){var e=this;this.mapId=document.getElementById("map"),this.mapId.style.display="none",this.orderDiv=document.getElementById("order"),this.orderDiv.style.display="block";var t=(new d.b).configureLogging(d.c.Information).withUrl("".concat(p.a.signalRUrl,"/orderHub")).build();t.start().then(function(){console.log("signalR Connected in travel-mode")}).catch(function(e){console.log("Reconnecting in 1 sec."),setTimeout(function(){return t.start()},1e3)}),t.on("NotifyDriver",function(t){e.subscriptions.push(e.orderService.getOrderById(t).subscribe(function(t){e.order.id==t.id&&(1==t.increaseAccepted?e.IncreaseAccepted(t):0==t.increaseAccepted&&e.IncreaseRefused())}))}),t.on("OrderDeleted",function(t){e.subscriptions.push(e.orderService.getOrderById(t).subscribe(function(t){e.order.id==t.id&&e.OrderTaken()}))})}},{key:"ionViewDidEnter",value:function(){var e=this;this.orderDiv.style.display="block",this.mapId.style.display="none",this.subscriptions.push(this.orderService.getOrderById(this.orderId).subscribe(function(t){if(null==t)return e.OrderTaken();e.canIncrease=t.totalPrice<=3.5,e.order=t,e.calculateEta(e.order),e.loadMap(e.mapRef)}))}},{key:"loadMap",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,i,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n={lat:+this.order.locationLat,lng:+this.order.locationLong},r={center:new google.maps.LatLng(n.lat,n.lng),zoom:14,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP,zoomControl:!1},null!=e&&(this.map=new google.maps.Map(e.nativeElement,r)),i={url:"https://www.freeiconspng.com/uploads/-human-male-man-people-person-profile-red-user-icon--icon--23.png",scaledSize:new window.google.maps.Size(25,25),anchor:{x:10,y:10}},o=new google.maps.Marker({position:new google.maps.LatLng(n),icon:i,map:this.map}),this.navigateToUserAndCalculateDistance(o);case 4:case"end":return t.stop()}},t,this)}))}},{key:"navigateToUserAndCalculateDistance",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,i,o,c,a,s=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new google.maps.DirectionsService,r=new google.maps.DirectionsRenderer,t.next=4,_.getCurrentPosition();case 4:i=t.sent,o={lat:i.coords.latitude,lng:i.coords.longitude},c=+this.order.locationLat,a=+this.order.locationLong,n.route({origin:{lat:o.lat,lng:o.lng},destination:{lat:c,lng:a},travelMode:google.maps.TravelMode.DRIVING},function(t,n){if("OK"===n){r.setDirections(t);var i=new google.maps.LatLng(o.lat,o.lng),l=new google.maps.LatLng(c,a);s.distance=(google.maps.geometry.spherical.computeDistanceBetween(i,l)/1e3).toFixed(2),new google.maps.InfoWindow({content:"".concat(s.distance," km from you.")}).open(s.map,e)}else window.alert("Directions request failed due to "+n)}),r.setMap(this.map);case 8:case"end":return t.stop()}},t,this)}))}},{key:"hideMap",value:function(){this.orderDiv.style.display="block",this.mapId.style.display="none",this.mapVisible=!1,this.orderDiv.cancelable&&this.orderDiv.preventDefault(),this.mapId.cancelable&&this.mapId.preventDefault()}},{key:"showMap",value:function(){this.orderDiv.style.display="none",this.mapId.style.display="block",this.mapVisible=!0,this.loadMap(this.mapRef),this.orderDiv.cancelable&&this.orderDiv.preventDefault(),this.mapId.cancelable&&this.mapId.preventDefault()}},{key:"offer",value:function(e){var t=this;this.subscriptions.push(this.orderService.getOrderById(this.order.id).subscribe(function(n){if("Canceled"==n.status)return t.OrderTaken(),void t.router.navigate(["menu/driving"]);t.subscriptions.push(t.orderService.driverIncreaseOrderPrice(t.order.id,e,t.accountService.userValue.driverId).subscribe(function(){}))}))}},{key:"calculateEta",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_.getCurrentPosition();case 2:n=t.sent,r={lat:n.coords.latitude,lng:n.coords.longitude},this.myLat=r.lat,this.myLng=r.lng,(new google.maps.DirectionsService).route({origin:{lat:+this.myLat,lng:+this.myLng},destination:{lat:+e.locationLat,lng:+e.locationLong},travelMode:google.maps.TravelMode.DRIVING},function(t,n){"OK"===n&&(e.eta=t.routes[0].legs[0].duration.text)});case 5:case"end":return t.stop()}},t,this)}))}},{key:"acceptOrder",value:function(e){var t=this;this.subscriptions.push(this.orderService.getOrderById(e.id).subscribe(function(n){if("Canceled"==n.status)return t.OrderTaken(),void t.router.navigate(["menu/driving"]);t.subscriptions.push(t.driverService.getDriverActiveCar(t.accountService.userValue.driverId).subscribe(function(n){if(1==n.typeId&&"Comfort"==e.carType)return t.WrongCarAlert();t.subscriptions.push(t.driverService.getDriver(t.accountService.userValue.driverId).subscribe(function(n){t.tripPriceForDriver=e.totalPrice*(n.comission/100),t.subscriptions.push(t.walletService.getMyWallet(t.applicationUserId).subscribe(function(n){if(n.ammount<t.tripPriceForDriver)t.NotEnoughCashAlert();else{var r=t.accountService.userValue.id;t.accountService.userValue.isDrivingNow=!0,t.subscriptions.push(t.accountService.updateDriving(t.applicationUserId,!0).subscribe(function(){})),t.isDrivingNow=t.accountService.userValue.isDrivingNow,e.acceptedBy=r,t.subscriptions.push(t.orderService.acceptOrder(e.id,r).subscribe(function(){t.subscriptions.push(t.orderService.updateOrderEta(i,e.eta).subscribe())}));var i=e.id;t.subscriptions.push(t.tripService.createTrip({orderId:i,applicationUserId:r,order:e}).subscribe(function(){})),t.router.navigate(["menu/driving-mode"])}}))}))}))}))}},{key:"openLanguagePopover",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverController.create({component:f.a,event:e});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}},t,this)}))}},{key:"NotEnoughCashAlert",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Balance",message:"Your wallet balance is not enough for this order!",buttons:["OK"]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}},e,this)}))}},{key:"OrderTaken",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Sorry",message:"This order is no longer active",buttons:[{text:"OK",handler:function(){n.router.navigate(["menu/driving"])}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}},e,this)}))}},{key:"IncreaseRefused",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Order increasing refused.",buttons:[{text:"Ok",role:"cancel"}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}},e,this)}))}},{key:"IncreaseAccepted",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Order increasing accepted.",message:"You can accept the order now",buttons:[{text:"Accept",handler:function(){r.acceptOrder(e)}},{text:"Cancel",role:"cancel"}]});case 2:return n=t.sent,t.next=5,n.present();case 5:case"end":return t.stop()}},t,this)}))}},{key:"WrongCarAlert",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({cssClass:"my-custom-class",header:"Order information",message:'Your car is of type "Normal" but the order desired car type is "Comfort"! ',buttons:["OK"]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}},e,this)}))}}])&&t(r.prototype,i),o&&t(r,o),n}(),j.\u0275fac=function(e){return new(e||j)(u.Kb(g.d),u.Kb(a.H),u.Kb(m.a),u.Kb(s.f),u.Kb(s.a),u.Kb(h.a),u.Kb(v.a),u.Kb(y.a),u.Kb(w.a),u.Kb(a.a))},j.\u0275cmp=u.Eb({type:j,selectors:[["app-order-details"]],viewQuery:function(e,t){var n;1&e&&u.vc(M,1,u.m),2&e&&u.hc(n=u.Wb())&&(t.mapRef=n.first)},decls:61,vars:34,consts:[["slot","start"],["slot","end"],["id","toolbarIcon","name","language-outline",3,"click"],["class","fonted btn btn-info col-md-12",3,"click",4,"ngIf"],["id","order",1,"col-md-10"],[1,"list-group","mt-2"],[1,"text","list-group-item","list-group-item-action","flex-column","align-items-start"],["name","alert-circle",4,"ngIf"],["id","warningicn",4,"ngIf"],[1,"d-flex","w-100","justify-content-between"],[1,"mb-1","fonted"],["name","analytics-outline",1,"mr-2"],["name","arrow-forward-outline",1,"mr-2"],[1,"row"],[1,"col"],[4,"ngIf"],[1,"w-100"],[1,"fonted"],["type","button",1,"fonted","btn","btn-info",3,"click"],["class","text-center",4,"ngIf"],["class","d-flex w-100 justify-content-between",4,"ngIf"],["padding","",1,"noScroll"],["id","map"],["map",""],[1,"fonted","btn","btn-info","col-md-12",3,"click"],["name","alert-circle"],["id","warningicn"],[1,"text-center"],["type","button",1,"btn","btn-info","btn-sm",3,"click"]],template:function(e,t){1&e&&(u.Nb(0,"ion-header"),u.Nb(1,"ion-toolbar"),u.Nb(2,"ion-buttons",0),u.Lb(3,"ion-menu-button"),u.Mb(),u.Nb(4,"ion-title"),u.Nb(5,"ion-label"),u.pc(6),u.Yb(7,"translate"),u.Mb(),u.Mb(),u.Nb(8,"ion-buttons",1),u.Nb(9,"ion-icon",2),u.Vb("click",function(e){return t.openLanguagePopover(e)}),u.Mb(),u.Mb(),u.Mb(),u.Mb(),u.Nb(10,"ion-content"),u.oc(11,k,3,3,"button",3),u.oc(12,I,3,3,"button",3),u.Nb(13,"div",4),u.Nb(14,"div",5),u.Nb(15,"a",6),u.oc(16,O,1,0,"ion-icon",7),u.oc(17,N,3,4,"small",8),u.Nb(18,"div",9),u.Lb(19,"h5",10),u.Nb(20,"small"),u.pc(21),u.Yb(22,"date"),u.Mb(),u.Mb(),u.Nb(23,"p"),u.Lb(24,"ion-icon",11),u.pc(25),u.Mb(),u.Lb(26,"hr"),u.Nb(27,"p"),u.Lb(28,"ion-icon",12),u.pc(29),u.Mb(),u.Nb(30,"div",9),u.Lb(31,"h5",10),u.Mb(),u.Nb(32,"div",13),u.Nb(33,"div",14),u.oc(34,x,3,3,"small",15),u.Nb(35,"ul"),u.oc(36,C,3,3,"li",15),u.oc(37,D,3,3,"li",15),u.oc(38,P,3,3,"li",15),u.Mb(),u.oc(39,L,3,3,"small",15),u.oc(40,S,3,1,"ul",15),u.oc(41,z,3,3,"small",15),u.oc(42,R,3,1,"ul",15),u.Nb(43,"div",16),u.Nb(44,"h5"),u.pc(45),u.Yb(46,"translate"),u.Mb(),u.Lb(47,"br"),u.Mb(),u.Nb(48,"div",9),u.Nb(49,"small",17),u.pc(50),u.Yb(51,"translate"),u.Mb(),u.Nb(52,"button",18),u.Vb("click",function(){return t.acceptOrder(t.order)}),u.pc(53),u.Yb(54,"translate"),u.Mb(),u.Mb(),u.Lb(55,"hr"),u.oc(56,T,3,3,"p",19),u.oc(57,V,11,0,"div",20),u.Mb(),u.Mb(),u.Mb(),u.Mb(),u.Mb(),u.Nb(58,"ion-content",21),u.Lb(59,"div",22,23),u.Mb(),u.Mb()),2&e&&(u.zb(6),u.qc(u.Zb(7,23,"Details")),u.zb(5),u.dc("ngIf",0==t.mapVisible),u.zb(1),u.dc("ngIf",1==t.mapVisible),u.zb(4),u.dc("ngIf",t.order.pickUpTime),u.zb(1),u.dc("ngIf",t.order.pickUpTime),u.zb(4),u.qc(u.ac(22,25,t.order.createdOn,"MM/dd/yyyy h:mm")),u.zb(4),u.qc(t.order.location),u.zb(4),u.qc(t.order.destination),u.zb(5),u.dc("ngIf",1==t.order.withPets||1==t.order.withStroller||1==t.order.special),u.zb(2),u.dc("ngIf",1==t.order.withPets),u.zb(1),u.dc("ngIf",1==t.order.withStroller),u.zb(1),u.dc("ngIf",1==t.order.special),u.zb(1),u.dc("ngIf",t.order.carType),u.zb(1),u.dc("ngIf",t.order.carType),u.zb(1),u.dc("ngIf",t.order.description),u.zb(1),u.dc("ngIf",t.order.description),u.zb(3),u.sc("",u.Zb(46,28,"Trip distance"),": ",t.order.tripDistance," km"),u.zb(5),u.sc("",u.Zb(51,30,"Total cost"),": ",t.order.totalPrice," \u043b\u0432."),u.zb(3),u.qc(u.Zb(54,32,"Accept")),u.zb(3),u.dc("ngIf",1==t.canIncrease),u.zb(1),u.dc("ngIf",1==t.canIncrease))},directives:[a.l,a.B,a.e,a.s,a.A,a.p,a.m,a.i,o.l],pipes:[g.c,o.d],styles:["ion-content[_ngcontent-%COMP%]{--ion-background-color:#e9e9e9}ion-toolbar[_ngcontent-%COMP%]{--ion-background-color:#eee}#map[_ngcontent-%COMP%]{height:100%;width:100%}ion-title[_ngcontent-%COMP%]{text-align:center}#warningicn[_ngcontent-%COMP%]{margin-left:6px}h5[_ngcontent-%COMP%]{font-size:.9em}#toolbarIcon[_ngcontent-%COMP%]{font-size:1.7em}.fonted[_ngcontent-%COMP%]{font-family:Open Sans Light}.centered[_ngcontent-%COMP%]{text-align:center}.text[_ngcontent-%COMP%]{font-family:Open Sans Light}hr[_ngcontent-%COMP%]{background:#eee;width:70%!important}.blink_me[_ngcontent-%COMP%]{-webkit-animation:blinker 1s linear infinite;animation:blinker 1s linear infinite}@-webkit-keyframes blinker{50%{opacity:0}}@keyframes blinker{50%{opacity:0}}.msg-box[_ngcontent-%COMP%]{width:100%;height:140px;padding:10px 30px;font-size:14px;font-family:Open Sans Light;overflow:auto}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:-5px;list-style:none}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .ex-msg[_ngcontent-%COMP%]{text-align:right}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .in-msg[_ngcontent-%COMP%]{text-align:left;margin-left:-60px}"]}),j)}],K=((A=function t(){e(this,t)}).\u0275fac=function(e){return new(e||A)},A.\u0275mod=u.Ib({type:A}),A.\u0275inj=u.Hb({imports:[[s.h.forChild(Y)],s.h]}),A),q=i("tk/3"),B=i("mqiu"),U=i("QhVT");function X(e){return new B.a(e)}var Z,E=((Z=function t(){e(this,t)}).\u0275fac=function(e){return new(e||Z)},Z.\u0275mod=u.Ib({type:Z}),Z.\u0275inj=u.Hb({imports:[[o.b,c.e,a.C,K,g.b.forChild({loader:{provide:g.a,useFactory:X,deps:[q.a]}}),U.LanguagePopoverPageModule]]}),Z)}}])}();