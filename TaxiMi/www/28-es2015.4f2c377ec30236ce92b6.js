(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{y67D:function(e,t,i){"use strict";i.r(t),i.d(t,"HttpLoaderFactory",function(){return A}),i.d(t,"TravelModePageModule",function(){return z});var r=i("ofXK"),n=i("3Pt+"),s=i("TEn/"),o=i("tyNb"),c=i("mrSG"),a=i("fXoL"),l=i("Gpoy"),d=i("gcOT"),u=i("AytR"),b=i("VeQZ"),h=i("oXKM"),p=i("8k+r"),g=i("8Xdb"),v=i("e7jj"),m=i("exMm"),f=i("RX8M"),M=i("sYmb"),y=i("Wwn5");const O=["map"];function C(e,t){if(1&e&&(a.Nb(0,"p"),a.pc(1),a.Yb(2,"translate"),a.Yb(3,"date"),a.Mb()),2&e){const e=a.Xb();a.zb(1),a.tc(" ",a.Zb(2,3,"Price"),": ",e.totalPrice," \u043b\u0432. | ",a.ac(3,5,1e3*e.secsDiff,"mm:ss")," ")}}function N(e,t){if(1&e&&(a.Nb(0,"p"),a.pc(1),a.Yb(2,"translate"),a.Mb()),2&e){const e=a.Xb();a.zb(1),a.sc(" ",a.Zb(2,2,"Price"),": ",e.totalPrice," \u043b\u0432. ")}}function S(e,t){if(1&e){const e=a.Ob();a.Nb(0,"button",26),a.Vb("click",function(){return a.jc(e),a.Xb().cancelTrip()}),a.pc(1),a.Yb(2,"translate"),a.Mb()}2&e&&(a.zb(1),a.rc(" ",a.Zb(2,1,"Cancel")," "))}function x(e,t){1&e&&(a.Nb(0,"ion-label",27),a.pc(1),a.Yb(2,"translate"),a.Mb()),2&e&&(a.zb(1),a.rc(" ",a.Zb(2,1,"You have new message"),". "))}function w(e,t){1&e&&(a.Nb(0,"ul",28),a.Nb(1,"li",29),a.pc(2),a.Yb(3,"translate"),a.Mb(),a.Mb()),2&e&&(a.zb(2),a.qc(a.Zb(3,1,"No messages for now")))}function k(e,t){if(1&e&&(a.Nb(0,"ul"),a.Nb(1,"li",30),a.pc(2),a.Mb(),a.Mb()),2&e){const e=t.$implicit,i=a.Xb();a.zb(1),a.dc("ngClass",e.user===i.msgDto.user?"in-msg":"ex-msg"),a.zb(1),a.sc(" ",e.user,": ",e.text," ")}}const{LocalNotifications:P}=d.c,I=[{path:"",component:(()=>{class e{constructor(e,t,i,r,n,s,o,c,a,l){this.route=e,this.orderService=t,this.accountService=i,this.tripService=r,this.driverService=n,this.alertController=s,this.chatService=o,this.translate=c,this.popoverController=a,this.callNumber=l,this.user=this.accountService.userValue,this.driverId=this.accountService.userValue.driverId,this.carModel="",this.carColor="",this.firstName="",this.lastName="",this.messages=this.chatService.messages,this.chatStyle="",this.subscriptions=[],this.maxTime=3e4,this.msgDto=new b.c,this.msgInboxArray=[],this.translate.setDefaultLang(this.accountService.userValue.choosenLanguage)}ngOnInit(){this.checkorder(),this.chatService.retrieveMappedObject().subscribe(e=>{this.addToInbox(e)});const e=(new l.b).configureLogging(l.c.Information).withUrl(`${u.a.signalRUrl}/orderHub`).build();e.start().then(function(){console.log("signalR Connected in travel-mode")}).catch(function(t){console.log("Reconnecting in 1 sec."),setTimeout(()=>e.start(),1e3)}),e.on("BroadcastMessage",()=>{console.log("broadcasted from travel-mode")}),e.on("StartTrip",()=>{this.checkorder()}),e.on("Navigate",()=>{this.checkorder()}),e.on("OrderAccepted",e=>{this.subscriptions.push(this.orderService.getOrderById(e).subscribe(e=>{e.id==this.order.id&&"Accepted"==e.status&&this.presentOrderAcceptedNotification()}))}),e.on("OrderWaiting",e=>{this.subscriptions.push(this.orderService.getMyOrder(this.user.id).subscribe(t=>{t.id==e&&this.canceledOrder()}))}),e.on("LocateDriver",e=>{this.subscriptions.push(this.orderService.getMyOrder(this.user.id).subscribe(t=>{this.subscriptions.push(this.driverService.getDriver(e).subscribe(t=>{t.id==e&&this.loadMap(this.mapRef,t.applicationUserId)}))}))}),e.on("NotifyArrived",e=>{this.subscriptions.push(this.orderService.getOrderById(e).subscribe(t=>{1==t.isDriverArrived&&this.order.id==e&&(this.presentDriverArrivedNotification(),this.accountService.userValue.alertTriggered=!0,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!0).subscribe(()=>{})),this.accountService.userValue.timer=new Date,60==this.seconds&&(this.seconds=0),this.startTimer())}))}),e.on("CompleteOrder",e=>{this.order.id==e&&this.completedOrderAlert()})}ionViewDidEnter(){this.checkorder(),1==this.accountService.userValue.alertTriggered&&this.startTimer()}checkorder(){this.subscriptions.push(this.orderService.getMyOrder(this.user.id).subscribe(e=>{e?(this.chatService.stop(),this.chatService.start(),this.totalPrice=e.totalPrice,this.orderStatus=e.status,this.orderAcceptedBy=e.acceptedBy,this.orderService.currentOrderId=e.id,this.location=e.location,this.destination=e.destination,(Math.round(100*this.orderTotalPrice)/100).toFixed(2),this.orderTotalPrice=e.totalPrice,this.order=e,this.estimatedDuration=e.eta,null!=e.acceptedBy&&(this.getUserById(e.acceptedBy),this.getAcceptedTrip(e.acceptedBy),this.driverId=e.acceptedBy)):(this.accountService.userValue.alertTriggered=!1,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!1).subscribe(()=>{})),this.orderTotalPrice=0)},e=>{console.log(e)}))}startTimer(){this.startTime=new Date(this.accountService.userValue.timer),setInterval(()=>{300!=this.secsDiff?(this.secsDiff=(new Date).getTime()-this.startTime.getTime(),this.secsDiff=Math.floor(this.secsDiff/1e3)):this.subscriptions.push(this.orderService.increaseOrderPrice(this.order.id,1).subscribe(()=>{}))},1e3)}presentOrderAcceptedNotification(){return Object(c.a)(this,void 0,void 0,function*(){yield P.schedule({notifications:[{title:"Order alert",body:"Your order is accepted",id:1}]})})}presentDriverArrivedNotification(){return Object(c.a)(this,void 0,void 0,function*(){yield P.schedule({notifications:[{title:"Order alert",body:"Your driver is on the address",id:2}]})})}chat(){var e=document.getElementById("chat");"none"===e.style.display?(e.style.display="block",this.chatStyle="block"):(e.style.display="none",this.chatStyle="none")}send(){if(this.msgDto){if(0==this.msgDto.text.length)return void window.alert("Text field is required.");this.msgDto.user=`${this.accountService.userValue.firstName} ${this.accountService.userValue.lastName}`,this.chatService.broadcastMessage(this.msgDto)}}clearMessages(){this.messages.length=0}addToInbox(e){let t=new b.c;t.user=e.user,t.text=e.text,this.msgInboxArray.push(t),this.msgDto.text=""}getUserById(e){this.subscriptions.push(this.accountService.getById(e).subscribe(e=>{this.firstName=e.firstName,this.lastName=e.lastName,this.driverId=e.driverId,this.phoneNumber=e.phone,this.subscriptions.push(this.driverService.getDriverActiveCar(e.driverId).subscribe(e=>{this.carModel=e.model,this.carColor=e.color}))}))}callDriver(){let e=this.phoneNumber.toString();this.callNumber.callNumber(e,!0).then(e=>console.log("Launched dialer!",e)).catch(e=>console.log("Error launching dialer",e))}getAcceptedTrip(e){this.subscriptions.push(this.tripService.getTrip(e).subscribe(t=>{null!=t?(this.tripStatus=t.status,"Started"==t.status&&(this.accountService.userValue.alertTriggered=!1,this.subscriptions.push(this.accountService.updateAlert(this.user.id,!1).subscribe(()=>{}))),this.currentTrip=t,this.loadMap(this.mapRef,e)):console.log("No trip!")}))}addToFavourite(){let e={applicationUserId:this.order.applicationUserId,location:this.order.location,locationLat:this.order.locationLat,locationLong:this.order.locationLong,destination:this.order.destination,destinationLat:this.order.destinationLat,destinationLong:this.order.destinationLong,totalPrice:this.order.totalPrice};e?this.subscriptions.push(this.orderService.addToFavourites(e).subscribe(()=>{this.successAddedFavourite()})):console.log("Problem with data occured")}loadMap(e,t){return Object(c.a)(this,void 0,void 0,function*(){this.subscriptions.push(this.accountService.getById(t).subscribe(t=>{this.subscriptions.push(this.driverService.getDriver(t.driverId).subscribe(t=>{const i={lat:+t.currentLocationLat,lng:+t.currentLocationLong},r={center:new google.maps.LatLng(i.lat,i.lng),zoom:15,disableDefaultUI:!0};null!=e&&(this.map=new google.maps.Map(e.nativeElement,r));var n={url:"https://images.vexels.com/media/users/3/154573/isolated/preview/bd08e000a449288c914d851cb9dae110-hatchback-car-top-view-silhouette-by-vexels.png",scaledSize:new window.google.maps.Size(25,25),anchor:{x:10,y:10}};new google.maps.Marker({position:new google.maps.LatLng(i),icon:n,map:this.map})}))}))})}cancelTrip(){return Object(c.a)(this,void 0,void 0,function*(){this.alertForCancel()})}alertForCancel(){return Object(c.a)(this,void 0,void 0,function*(){this.translate.get(["Are you sure you want to cancel the order?","Your rating will decrease!","Confirm","Cancel"]).subscribe(e=>Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:e["Are you sure you want to cancel the order?"],message:e["Your rating will decrease!"],buttons:[{text:e.Confirm,handler:()=>{this.subscriptions.push(this.tripService.getTrip(this.orderAcceptedBy).subscribe(e=>{this.subscriptions.push(this.tripService.cancelTrip(e.id).subscribe(t=>{this.subscriptions.push(this.accountService.updateDriving(this.orderAcceptedBy,!1).subscribe(()=>{})),this.accountService.userValue.isDrivingNow=!1,this.subscriptions.push(this.orderService.deleteOrder(e.orderId).subscribe(()=>this.route.navigate(["menu/travelling"])))}))}))}},{text:e.Cancel,role:"cancel"}]});yield t.present()}))})}openLanguagePopover(e){return Object(c.a)(this,void 0,void 0,function*(){const t=yield this.popoverController.create({component:h.a,event:e});yield t.present()})}completedOrderAlert(){return Object(c.a)(this,void 0,void 0,function*(){this.translate.get(["You have reached the final destination! Did you enjoyed the trip?","Yes","No","Cancel","Report a problem"]).subscribe(e=>Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:e["You have reached the final destination! Did you enjoyed the trip?"],buttons:[{text:e.Yes,role:"cancel",handler:()=>{this.subscriptions.push(this.driverService.voteUp(this.driverId).subscribe(e=>{})),this.route.navigate(["menu/travelling"]),window.location.reload()}},{text:e.No,role:"no",handler:()=>{this.subscriptions.push(this.driverService.voteDown(this.driverId).subscribe(e=>{})),this.route.navigate(["menu/travelling"]),window.location.reload()}},{text:e.Cancel,role:"cancel",handler:()=>{this.route.navigate(["menu/travelling"]),window.location.reload()}},{text:e["Report a problem"],role:"cancel",handler:()=>{this.route.navigate(["menu/report"])}}]});this.route.navigate(["menu/travelling"]),yield t.present()}))})}successAddedFavourite(){return Object(c.a)(this,void 0,void 0,function*(){this.translate.get(["Successfully added to favourites!","Cancel"]).subscribe(e=>Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:e["Successfully added to favourites!"],buttons:[{text:e.Cancel,role:"cancel"}]});yield t.present()}))})}canceledOrder(){return Object(c.a)(this,void 0,void 0,function*(){this.translate.get(["Order is cancelled by the driver."]).subscribe(e=>Object(c.a)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:e["Order is cancelled by the driver."],buttons:[{text:"Ok",handler:()=>{this.route.navigate(["menu/travelling"])}}]});yield t.present()}))})}}return e.\u0275fac=function(t){return new(t||e)(a.Kb(o.f),a.Kb(p.a),a.Kb(g.a),a.Kb(v.a),a.Kb(m.a),a.Kb(s.a),a.Kb(f.a),a.Kb(M.d),a.Kb(s.H),a.Kb(y.a))},e.\u0275cmp=a.Eb({type:e,selectors:[["app-travel-mode"]],viewQuery:function(e,t){if(1&e&&a.vc(O,1,a.m),2&e){let e;a.hc(e=a.Wb())&&(t.mapRef=e.first)}},decls:55,vars:34,consts:[["slot","start"],[1,"blink_me"],["slot","end"],["id","toolbarIcon","name","language-outline",3,"click"],["id","map"],["map",""],[1,"row"],[1,"col"],[1,"list-group"],[1,"list-group-item","list-group-item-action","flex-column","align-items-start"],["name","analytics-outline",1,"mr-2"],[1,"d-flex","w-100","justify-content-between"],[4,"ngIf"],["type","button",1,"fonted","btn","btn-warning","mb-1",3,"click"],["name","call",1,"mr-2"],["type","button",1,"fonted","btn","btn-secondary","mr-1",3,"click"],["type","button",1,"fonted","btn","btn-info",3,"click"],["class","fonted btn btn-warning ml-1","type","button",3,"click",4,"ngIf"],["class","blink_me fonted",4,"ngIf"],["id","chat",1,"row","chat",2,"display","none"],[1,"msg-box"],["class","text-center mr-5",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"type"],[3,"ngModel","placeholder","ngModelChange"],["name","send-outline",3,"click"],["type","button",1,"fonted","btn","btn-warning","ml-1",3,"click"],[1,"blink_me","fonted"],[1,"text-center","mr-5"],[1,"fonted"],[1,"fonted",3,"ngClass"]],template:function(e,t){1&e&&(a.Nb(0,"ion-content"),a.Nb(1,"ion-header"),a.Nb(2,"ion-toolbar"),a.Nb(3,"ion-buttons",0),a.Lb(4,"ion-menu-button"),a.Mb(),a.Nb(5,"ion-title"),a.Nb(6,"ion-label",1),a.pc(7),a.Yb(8,"translate"),a.Mb(),a.Mb(),a.Nb(9,"ion-buttons",2),a.Nb(10,"ion-icon",3),a.Vb("click",function(e){return t.openLanguagePopover(e)}),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Lb(11,"div",4,5),a.Mb(),a.Nb(13,"ion-footer"),a.Nb(14,"div",6),a.Nb(15,"div",7),a.Nb(16,"div",8),a.Nb(17,"a",9),a.Nb(18,"p"),a.pc(19),a.Yb(20,"translate"),a.Yb(21,"translate"),a.Mb(),a.Lb(22,"hr"),a.Nb(23,"p"),a.Lb(24,"ion-icon",10),a.pc(25),a.Mb(),a.Lb(26,"hr"),a.Nb(27,"div",11),a.oc(28,C,4,8,"p",12),a.oc(29,N,3,4,"p",12),a.Nb(30,"button",13),a.Vb("click",function(){return t.callDriver()})("click",function(){return t.clearMessages()}),a.Lb(31,"ion-icon",14),a.pc(32),a.Yb(33,"translate"),a.Mb(),a.Mb(),a.Nb(34,"div",11),a.Nb(35,"button",15),a.Vb("click",function(){return t.chat()})("click",function(){return t.clearMessages()}),a.pc(36),a.Yb(37,"translate"),a.Mb(),a.Nb(38,"button",16),a.Vb("click",function(){return t.addToFavourite()}),a.pc(39),a.Yb(40,"translate"),a.Mb(),a.oc(41,S,3,3,"button",17),a.Mb(),a.Lb(42,"br"),a.oc(43,x,3,3,"ion-label",18),a.Nb(44,"div",19),a.Nb(45,"div",7),a.Nb(46,"ion-card"),a.Nb(47,"div",20),a.oc(48,w,4,3,"ul",21),a.oc(49,k,3,3,"ul",22),a.Mb(),a.Mb(),a.Nb(50,"ion-card",23),a.Nb(51,"ion-item"),a.Nb(52,"ion-input",24),a.Vb("ngModelChange",function(e){return t.msgDto.text=e}),a.Yb(53,"translate"),a.Mb(),a.Nb(54,"ion-icon",25),a.Vb("click",function(){return t.send()}),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb(),a.Mb()),2&e&&(a.zb(7),a.qc(a.Zb(8,20,"Waiting for the car")),a.zb(12),a.uc("",t.firstName," ",t.lastName," ",a.Zb(20,22,"will arrive with")," ",t.carColor," ",t.carModel," ",a.Zb(21,24,"in about")," ",t.estimatedDuration,"."),a.zb(6),a.rc("",t.destination," "),a.zb(3),a.dc("ngIf",1==t.accountService.userValue.alertTriggered),a.zb(1),a.dc("ngIf",0==t.accountService.userValue.alertTriggered),a.zb(3),a.rc("",a.Zb(33,26,"Call driver")," "),a.zb(4),a.rc(" ",a.Zb(37,28,"Chat")," "),a.zb(3),a.rc(" ",a.Zb(40,30,"Add to favourites")," "),a.zb(2),a.dc("ngIf","Processing"==t.tripStatus),a.zb(2),a.dc("ngIf",0!=t.messages.length&&"none"==t.chatStyle),a.zb(5),a.dc("ngIf",0==t.msgInboxArray.length),a.zb(1),a.dc("ngForOf",t.msgInboxArray),a.zb(3),a.dc("ngModel",t.msgDto.text)("placeholder",a.Zb(53,32,"Type your message...")))},directives:[s.i,s.l,s.B,s.e,s.s,s.A,s.p,s.m,s.k,r.l,s.f,r.k,s.o,s.n,s.K,n.h,n.j,r.j],pipes:[M.c,r.d],styles:["ion-content[_ngcontent-%COMP%]{--ion-background-color:#353535}ion-toolbar[_ngcontent-%COMP%]{--ion-background-color:#eee}ion-title[_ngcontent-%COMP%]{text-align:center}#marker[_ngcontent-%COMP%]{position:absolute;background:url(http://maps.gstatic.com/mapfiles/markers2/marker.png) no-repeat;top:50%;left:50%;z-index:1;margin-left:-10px;margin-top:-34px;height:34px;width:20px;cursor:pointer}#map[_ngcontent-%COMP%]{height:100%;width:100%}#toolbarIcon[_ngcontent-%COMP%]{font-size:1.7em}.centered[_ngcontent-%COMP%]{text-align:center}.textTravel[_ngcontent-%COMP%]{font-size:1.5em}.text[_ngcontent-%COMP%], .textTravel[_ngcontent-%COMP%]{font-family:Open Sans Light}.text[_ngcontent-%COMP%]{font-size:2.4em}i[_ngcontent-%COMP%]{color:#eee}.my-custom-class[_ngcontent-%COMP%]{--background:#e5e5e5}.checkbox-icon[_ngcontent-%COMP%]{color:#fff}ion-checkbox[_ngcontent-%COMP%]{--border-color:#fff}ion-select[_ngcontent-%COMP%]{color:#383838;background-color:#fff;border-radius:10px;border:3px solid #eee}.blink_me[_ngcontent-%COMP%]{-webkit-animation:blinker 1s linear infinite;animation:blinker 1s linear infinite}@-webkit-keyframes blinker{50%{opacity:0}}@keyframes blinker{50%{opacity:0}}.backIcon[_ngcontent-%COMP%]{font-size:150%}.back[_ngcontent-%COMP%], .backIcon[_ngcontent-%COMP%]{color:#ffae00}.fonted[_ngcontent-%COMP%], .msg-box[_ngcontent-%COMP%]{font-family:Open Sans Light}.msg-box[_ngcontent-%COMP%]{width:100%;height:140px;padding:10px 30px;font-size:14px;overflow:auto}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:-5px;list-style:none}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .ex-msg[_ngcontent-%COMP%]{text-align:right}.msg-box[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   .in-msg[_ngcontent-%COMP%]{text-align:left;margin-left:-60px}"]}),e})()}];let T=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.Ib({type:e}),e.\u0275inj=a.Hb({imports:[[o.h.forChild(I)],o.h]}),e})();var D=i("tk/3"),L=i("mqiu"),_=i("QhVT");function A(e){return new L.a(e)}let z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.Ib({type:e}),e.\u0275inj=a.Hb({providers:[y.a],imports:[[r.b,n.e,s.C,T,M.b.forChild({loader:{provide:M.a,useFactory:A,deps:[D.a]}}),_.LanguagePopoverPageModule]]}),e})()}}]);